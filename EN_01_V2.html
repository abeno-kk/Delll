<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>國一英文第一課練習題庫</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --primary-color:#4a90e2;
      --secondary-color:#50e3c2;
      --accent-color:#f5a623;
      --danger-color:#e74c3c;
      --success-color:#2ecc71;
      --neutral-color:#2980b9;
      --warning-color:#f39c12;
      --bg-color:#f6f8fa;
      --text-color:#333;
    }
    body{font-family:"Segoe UI","Helvetica Neue",Arial,sans-serif;margin:0;padding:20px;background:var(--bg-color);color:var(--text-color)}
    h1{margin:0 0 20px;text-align:center;color:var(--primary-color);font-weight:600}

    .quiz-container{max-width:800px;background:#fff;margin:20px auto;padding:30px 40px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.06);position:relative;border-top:6px solid var(--primary-color)}
    #navbar{text-align:center;margin-bottom:20px}
    #navbar a{margin:0 15px;font-weight:600;color:var(--text-color);text-decoration:none;padding:8px 12px;border-radius:6px;transition:background-color .2s ease}
    #navbar a:hover{background:rgba(0,0,0,.05)}
    #navbar a.active{border-bottom:3px solid var(--primary-color);padding-bottom:4px}

    #timer{position:absolute;top:10px;right:15px;font-size:.85em;color:#666}
    #progress{margin-bottom:10px;font-weight:600}
    .question{font-size:1.15em;margin-bottom:15px}
    .section-label{font-size:.85em;color:var(--secondary-color);margin-bottom:5px}
    .options{list-style:none;padding:0}
    .options li{margin-bottom:10px}
    .options input[type="radio"]{margin-right:6px}
    .navigation{margin-top:20px;display:flex;justify-content:space-between;align-items:center}
    button{padding:10px 20px;font-size:1em;border:none;border-radius:6px;cursor:pointer;transition:background-color .3s ease,box-shadow .2s ease}
    button:disabled{background:#ccc;cursor:not-allowed}
    #submitBtn{background:var(--primary-color);color:#fff}
    #submitBtn:hover:not(:disabled){background:#357ab7}
    #nextBtn{background:var(--success-color);color:#fff}
    #nextBtn:hover:not(:disabled){background:#239a5a}
    #restartBtn{background:var(--danger-color);color:#fff;width:100%;margin-top:25px}
    #restartBtn:hover{background:#c0392b}
    #result{text-align:center;font-size:1.1em;margin-top:20px;line-height:1.5}
    #wrong-list{margin-top:15px;background:#f9f9f9;border-radius:6px;padding:15px}
    #wrong-list h3{margin:0;color:var(--danger-color)}
    #wrong-list ul{list-style:disc;padding-left:18px}

    .section-buttons{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:20px;margin-top:20px}
    .section-btn{color:#fff;font-weight:600;padding:12px 16px;border:none;border-radius:8px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.1);transition:transform .1s ease,box-shadow .2s ease}
    .section-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}
    .section-group{margin-bottom:25px}
    .section-group h3{margin:0 0 10px;color:var(--primary-color);font-size:1.1em;font-weight:600}
    .btn-purple{background:#8e44ad}.btn-red{background:#e74c3c}.btn-green{background:#16a085}.btn-blue{background:#2980b9}.btn-orange{background:#f39c12}.btn-teal{background:#1abc9c}

    #historyContainer table{width:100%;border-collapse:collapse}
    #historyContainer th,#historyContainer td{padding:10px;border:1px solid #e1e4e8;text-align:center}
    #historyContainer th{background:#f5f7fa;font-weight:600}

    .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,.4)}
    .modal-content{background:#fff;margin:80px auto;padding:20px;border-radius:8px;max-width:600px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .modal-content h3{margin-top:0;color:var(--primary-color)}
    .modal-close{float:right;font-size:1.4em;cursor:pointer;color:#999}
    .modal-close:hover{color:#666}

    /* ⬇⬇⬇ 新增：浮動選單與側邊面板樣式 ⬇⬇⬇ */
    #openSideMenu{
      position:fixed;right:18px;bottom:24px;z-index:1200;background:var(--primary-color);color:#fff;border:none;border-radius:28px;
      padding:12px 16px;font-weight:700;box-shadow:0 6px 14px rgba(0,0,0,.15);cursor:pointer;display:none
    }
    #sideMenu{position:fixed;top:0;right:-320px;width:320px;max-width:86vw;height:100vh;background:#fff;box-shadow:-4px 0 16px rgba(0,0,0,.1);
      z-index:1300;transition:right .25s ease;display:flex;flex-direction:column}
    #sideMenu.open{right:0}
    #sideMenuHeader{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #eee}
    #sideMenuHeader h3{margin:0;color:var(--primary-color)}
    #sideMenuBody{padding:12px 16px;overflow-y:auto}
    .side-group-title{margin:14px 0 8px;color:#666;font-size:.9em;font-weight:700}
    .side-link{width:100%;text-align:left;margin-bottom:10px;padding:10px 12px;border:1px solid #eef1f5;border-radius:10px;background:#f8fafc;cursor:pointer;font-weight:600}
    .side-link:hover{background:#f1f5fb}
    #sideMenuMask{position:fixed;inset:0;background:rgba(0,0,0,.25);z-index:1250;display:none}
    #sideMenuMask.show{display:block}
    /* ⬆⬆⬆ 新增樣式結束 ⬆⬆⬆ */
  </style>
</head>
<body>
  <h1>國一英文第一課練習題庫</h1>

  <!-- 導覽列 -->
  <nav id="navbar">
    <a href="index.html">選課程</a>
    <a id="quizTab" href="#" class="active">練習選單</a>
    <a id="historyTab" href="#">歷史紀錄</a>
  </nav>

  <!-- 練習分類 -->
  <div class="quiz-container" id="section-section">
    <h2 style="text-align:center;">選擇練習分類開始測驗</h2>

    <div class="section-group">
      <h3>單字練習</h3>
      <div class="section-buttons">
        <button class="section-btn btn-orange" data-section="vocab">單字練習</button>
      </div>
    </div>

    <div class="section-group">
      <h3>家庭/職業練習</h3>
      <div class="section-buttons">
        <button class="section-btn btn-teal" data-section="2">家庭/職業練習</button>
      </div>
    </div>

    <div class="section-group">
      <h3>文法/句型練習</h3>
      <div class="section-buttons">
        <button class="section-btn btn-purple" data-section="greeting">問候語練習</button>
        <button class="section-btn btn-red" data-section="be_questions">Be動詞疑問練習</button>
        <button class="section-btn btn-green" data-section="wh_questions">Who/How問句練習</button>
        <button class="section-btn btn-blue" data-section="possessive">所有格練習</button>
        <button class="section-btn btn-orange" data-section="adj_and">形容詞/連接詞練習</button>
      </div>
    </div>

    <div class="section-group">
      <h3>發音練習</h3>
      <div class="section-buttons">
        <button class="section-btn btn-teal" data-section="sounds">發音練習</button>
      </div>
    </div>
  </div>

  <!-- 作答區 -->
  <div class="quiz-container" id="quiz-section" style="display:none;">
    <h2 id="sectionTitle" style="text-align:center;margin:0 0 15px;color:var(--primary-color)"></h2>
    <div id="articleContainer" style="display:none;margin-bottom:20px;background:#f9f9f9;border-radius:5px;padding:15px"></div>
    <div id="timer">已用時間：00:00</div>
    <div id="progress">第 1 / 20 題</div>
    <div id="quiz">
      <div class="question" id="question"></div>
      <ul class="options" id="options"></ul>
    </div>
    <div class="navigation">
      <button id="submitBtn">確認答案</button>
      <button id="nextBtn" style="display:none;">下一題</button>
    </div>
    <div id="result"></div>
    <div id="wrong-list" style="display:none;"></div>
    <button id="nextSectionBtn" style="display:none;width:100%;margin-top:15px;background:var(--secondary-color);color:#fff;padding:12px;border:none;border-radius:6px;font-size:1em;cursor:pointer;"></button>
    <button id="restartBtn" style="display:none;">重新開始</button>
  </div>

  <!-- 歷史紀錄 -->
  <div class="quiz-container" id="history-section" style="display:none;">
    <h2 style="text-align:center;">歷史紀錄</h2>
    <div id="historyContainer" style="margin-top:20px;"></div>
  </div>

  <!-- 錯誤詳情 Modal -->
  <div id="wrongModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="modal-close">×</span>
      <div id="wrongDetails"></div>
    </div>
  </div>

  <!-- ⬇⬇⬇ 新增：右下角浮動按鈕 + 側邊選單 + 遮罩 ⬇⬇⬇ -->
  <button id="openSideMenu">≡ 選單</button>
  <div id="sideMenuMask"></div>
  <aside id="sideMenu" aria-hidden="true">
    <div id="sideMenuHeader">
      <h3>快速選單</h3>
      <button id="closeSideMenu" title="關閉" style="background:none;border:none;font-size:22px;cursor:pointer;color:#999">×</button>
    </div>
    <div id="sideMenuBody"></div>
  </aside>
  <!-- ⬆⬆⬆ 新增結束 ⬆⬆⬆ -->

  <script>
    /***********************
     * 題庫（保留你原本的內容）
     ************************/
    const sectionQuestions = {
      /* 這裡放你原本的題庫，我已經保留與整合（節錄不變） */
      '1': [
        { question: "什麼問候語在早上使用？", options: ["Good morning", "Good afternoon", "Good evening", "Good night"], correct: 0 },
        { question: "Nice to meet you. 這句話用於什麼時候？", options: ["第一次見面", "道別時", "打電話", "介紹他人"], correct: 0 },
        { question: "自我介紹時，哪一句正確？", options: ["I am Tom.", "He am Tom.", "Me Tom.", "They am Tom."], correct: 0 },
        { question: "填空：Hello, ___ name is Linda.", options: ["my", "me", "I", "mine"], correct: 0 },
        { question: "哪一句適合晚安時說再見？", options: ["Good night", "Good morning", "Good afternoon", "Hello"], correct: 0 },
        { question: "面對『Hi, I'm Sam.』你要如何回應？", options: ["Hi, I'm Tom.", "I'm 12.", "Good morning.", "Who is he?"], correct: 0 },
        { question: "下列哪一句使用 Hello 正確？", options: ["Hello, Gary", "Hello, is Mary", "Good Hello", "Hello big."], correct: 0 },
        { question: "哪一句是用來詢問年齡？", options: ["How old are you?", "Who are you?", "How are you?", "Where are you?"], correct: 0 },
        { question: "Look at that handsome boy. 此句中 that 的詞性是？", options: ["限定詞/形容詞", "動詞", "冠詞", "名詞"], correct: 0 },
        { question: "填空：____ your name?", options: ["What's", "Who's", "Where's", "How's"], correct: 0 },
        { question: "Who is 的縮寫是？", options: ["whos", "who's", "who is'", "whos'"], correct: 1 },
        { question: "Good afternoon 用於何時？", options: ["早上", "下午", "晚上", "深夜"], correct: 1 },
        { question: "課本中哪一句是詢問職業？", options: ["Is he a student?", "How old is he?", "Who is he?", "Where is he?"], correct: 0 },
        { question: "問句 Who's that man? 是在詢問什麼？", options: ["這個人的身分", "這個人的年齡", "他的職業", "他的衣服顏色"], correct: 0 },
        { question: "句子 My name is Peggy. 中 my 意為？", options: ["我的", "妳的", "他的", "你的"], correct: 0 }
      ],
      '2': [
        { question: "My mom's brother is my _____.", options: ["uncle","aunt","cousin","brother"], correct: 0 },
        { question: "My father's mother is my ______.", options: ["grandmother","grandfather","aunt","mother"], correct: 0 },
        { question: "woman 的複數為？", options: ["women","womans","womens","woment"], correct: 0 },
        { question: "office worker 是什麼職業？", options: ["在辦公室工作的人","歌手","警察","護士"], correct: 0 },
        { question: "Are they your parents? 正確回答？", options: ["Yes, they are.","Yes, they is.","Yes, they isn't.","Yes, they be."], correct: 0 },
        { question: "下列哪個複數形式正確？", options: ["baby–babies","family–familys","child–childs","cousin–cousins"], correct: 0 }
      ],
      '3': [
        { question: "填空：This is ___ orange.", options: ["an","a","the","one"], correct: 0 },
        { question: "I am not 的縮寫為？", options: ["I'm not","I amn't","I isn't","I'mn't"], correct: 0 },
        { question: "下列哪個 Yes/No 問句正確？", options: ["Is Alice a teacher?","Is a teacher Alice?","Alice is a teacher?","Is Alice teacher?"], correct: 0 },
        { question: "Are you happy? 的肯定簡答？", options: ["Yes, I am.","Yes, I'm.","Yes, you am.","Yes, I is."], correct: 0 }
      ],
      '5': [
        { question:"哪一個單字可以表示『顏色』？",options:["black","teacher","run","book"],correct:0 },
        { question:"選出正確否定句：",options:["He is not thin.","He not is thin.","He is thin not.","He are not thin."],correct:0 }
      ],
      'greeting': [
        { question:"早上打招呼時應該說什麼？", options:["Good morning","Good afternoon","Good evening","Good night"], correct:0 },
        { question:"第一次見面常說？", options:["Nice to meet you","See you","Good night","Hello"], correct:0 }
      ],
      'be_questions': [
        { question:"\"He is not tall.\" 的縮寫？", options:["He's not tall.","He not tall.","He isn't tall.","He aren't tall."], correct:2 },
        { question:"\"Are they your friends?\" 的否定簡答？", options:["No, they aren't.","No, they are.","No, they isn't.","Yes, they are not."], correct:0 }
      ],
      'wh_questions': [
        { question:"正確詢問年齡？", options:["How old are you?","How old you are?","How you old are?","How are you old?"], correct:0 },
        { question:"Who's that woman? 的正確回答？", options:["She's my teacher.","He is my teacher.","She's my teacher?","Her is my teacher."], correct:0 }
      ],
      'possessive': [
        { question:"That is ___ book. (他)", options:["his","her","our","their"], correct:0 },
        { question:"Mr. and Mrs. Ma's 表示？", options:["他們夫妻的所有","兩個老師","女孩的名字","地點"], correct:0 }
      ],
      'adj_and': [
        { question:"合併：This car is big. This car is new.", options:["This car is big and new.","This car and new is big.","This big and new car is.","This car new and big is."], correct:0 },
        { question:"Which uses 'too' 正確？", options:["She's beautiful, too.","She's too beautiful,","She too is beautiful.","She's beautiful too?."], correct:0 }
      ],
      'sounds': [
        { question:'Which word has the vowel sound [ʌ]?', options:['fun','on','box','not'], correct:0 },
        { question:'Which consonant sound does "watch" begin with?', options:['[w]','[m]','[n]','[s]'], correct:0 }
      ]
    };

    const sectionNames = {
      'combined':'綜合段落','4':'閱讀理解','article':'文章練習','reading2':'閱讀補充',
      'vocab':'單字練習','theme':'主題單字','grammar':'介系詞與問句','plural':'複數規則',
      'dialogue':'對話理解','sounds':'音標字母','2':'家庭/職業練習',
      'greeting':'問候語練習','be_questions':'Be動詞疑問練習','wh_questions':'Who/How問句練習',
      'possessive':'所有格練習','adj_and':'形容詞/連接詞練習'
    };
    const sectionOrder = ['combined','4','article','reading2','vocab','theme','grammar','plural','dialogue','sounds'];

    const readingPassages = [
      {
        title:'At school',
        text:`Jamie: Good morning, Yuki.\nYuki: Good morning, Jamie.\nJamie: Look at that handsome boy.\nYuki: Who is he?\nJamie: He's my classmate. His name is Zac.\nYuki: And the young woman? Who is she?\nJamie: She's my aunt. Her name is Sophie. She's a nurse.\nYuki: She's very tall.\nJamie: She's beautiful, too.`,
        questions:[
          { question:'Who is the handsome boy?', options:["Jamie's classmate Zac","Yuki's brother","Jamie's uncle","The young woman's son"], correct:0 },
          { question:"What is the young woman's job?", options:["Nurse","Police officer","Teacher","Singer"], correct:0 }
        ]
      },
      {
        title:'My Dear Family',
        text:`Hi, I'm Jamie, and this is my dear family. We are a family of five. My mom is an office worker. She's thirty-five years old. My dad is a teacher. He's thirty-five, too. My sister is an elementary school student, and I'm a junior high school student. She's ten, and I'm thirteen. My baby brother, Dan, is one year old. My family is very dear to me.`,
        questions:[
          { question:'How many people are in Jamie’s family?', options:['Five','Four','Six','Three'], correct:0 },
          { question:"What is Jamie's father's job?", options:['Teacher','Office worker','Doctor','Police officer'], correct:0 }
        ]
      }
    ];

    const articleExercises = [
      {
        title:'Self Introduction',
        text:`Hello, I'm Tom. Nice to meet you. This is my friend Anna. She is a singer. Anna is tall and beautiful. She is twenty years old. We are in the same class.`,
        questions:[
          { question:"What is Anna's job?", options:['Singer','Writer','Teacher','Police officer'], correct:0 },
          { question:"How old is Anna?", options:['Twenty','Thirty-five','Ten','Twelve'], correct:0 }
        ]
      }
    ];

    const vocabList = [
      { chinese:'英俊的', english:'handsome' },
      { chinese:'同學', english:'classmate' },
      { chinese:'女人', english:'woman' },
      { chinese:'年輕的', english:'young' },
      { chinese:'非常/很', english:'very' },
      { chinese:'美麗的', english:'beautiful' },
      { chinese:'堂表兄弟姊妹', english:'cousin' },
      { chinese:'歌手', english:'singer' },
      { chinese:'上班族', english:'office worker' },
      { chinese:'家庭主婦', english:'housewife' },
      { chinese:'警察', english:'police officer' },
      { chinese:'作家', english:'writer' },
      { chinese:'叔叔/舅舅', english:'uncle' },
      { chinese:'嬸嬸/姑媽', english:'aunt' },
      { chinese:'丈夫', english:'husband' },
      { chinese:'妻子', english:'wife' },
      { chinese:'兒子', english:'son' },
      { chinese:'女兒', english:'daughter' },
      { chinese:'家人；家庭', english:'family' },
      { chinese:'嬰兒', english:'baby' }
    ];

    /* ===== 變數、DOM ===== */
    let questions=[], currentQuestion=0, score=0, seconds=0, startTime=0, timerInterval=null;
    const wrongAnswers=[], sectionTitleEl=document.getElementById('sectionTitle'), nextSectionBtn=document.getElementById('nextSectionBtn');
    let currentSection=null, currentSectionId='';
    const questionEl=document.getElementById('question'), optionsEl=document.getElementById('options'), submitBtn=document.getElementById('submitBtn'), nextBtn=document.getElementById('nextBtn'), resultEl=document.getElementById('result'), restartBtn=document.getElementById('restartBtn'), timerEl=document.getElementById('timer'), progressEl=document.getElementById('progress'), wrongListContainer=document.getElementById('wrong-list'), historyContainer=document.getElementById('historyContainer'), quizSection=document.getElementById('quiz-section'), historySection=document.getElementById('history-section'), sectionSection=document.getElementById('section-section'), articleContainer=document.getElementById('articleContainer'), quizTab=document.getElementById('quizTab'), historyTab=document.getElementById('historyTab');

    function setSectionTitle(id){ sectionTitleEl.textContent = sectionNames[id]||''; }
    function prepareNextSection(currentId){
      const idx = sectionOrder.indexOf(currentId);
      if(idx>=0 && idx<sectionOrder.length-1){
        const nextId = sectionOrder[idx+1], nextName=sectionNames[nextId]||'';
        nextSectionBtn.textContent=`前往下一階段：${nextName}`;
        nextSectionBtn.dataset.section=nextId;
        nextSectionBtn.style.display='block';
      }else{ nextSectionBtn.style.display='none'; }
    }

    function loadQuestion(index){
      resultEl.textContent='';
      const q=questions[index];
      questionEl.innerHTML=`${index+1}. ${q.question}`;
      optionsEl.innerHTML='';
      q.options.forEach((op,i)=>{
        const li=document.createElement('li');
        const label=document.createElement('label');
        const input=document.createElement('input');
        input.type='radio'; input.name='option'; input.value=i;
        label.appendChild(input); label.appendChild(document.createTextNode(op));
        li.appendChild(label); optionsEl.appendChild(li);
      });
      submitBtn.disabled=false; nextBtn.style.display='none';
      progressEl.textContent=`第 ${index+1} / ${questions.length} 題`;
    }
    function checkAnswer(){
      const selected=document.querySelector('input[name="option"]:checked');
      if(!selected){ alert('請選擇一個答案！'); return; }
      const ans=parseInt(selected.value), correct=questions[currentQuestion].correct;
      if(ans===correct){ score++; resultEl.style.color='#2ecc71'; resultEl.textContent='回答正確！'; }
      else{
        resultEl.style.color='#e74c3c';
        const ct=questions[currentQuestion].options[correct];
        resultEl.textContent=`答錯了！正確答案是：${ct}`;
        wrongAnswers.push({question:questions[currentQuestion].question, correctAnswer:ct, userAnswer:questions[currentQuestion].options[ans]});
      }
      submitBtn.disabled=true;
      if(currentQuestion<questions.length-1){ nextBtn.style.display='inline-block'; } else { showFinalResult(); }
    }
    function nextQuestion(){ currentQuestion++; loadQuestion(currentQuestion); }

    function showFinalResult(){
      questionEl.style.display='none'; optionsEl.style.display='none'; submitBtn.style.display='none'; nextBtn.style.display='none';
      stopTimer();
      const totalTime=formatTime(seconds);
      resultEl.style.color='#34495e';
      resultEl.innerHTML=`您答對了 ${score} 題，共 ${questions.length} 題。<br/>總完成時間：${totalTime}`;
      if(wrongAnswers.length>0){
        wrongListContainer.style.display='block';
        wrongListContainer.innerHTML='<h3>需要複習的題目：</h3>';
        const ul=document.createElement('ul');
        wrongAnswers.forEach(it=>{ const li=document.createElement('li'); li.textContent=`${it.question} → 正確答案：${it.correctAnswer}`; ul.appendChild(li); });
        wrongListContainer.appendChild(ul);
      }else{ wrongListContainer.style.display='block'; wrongListContainer.innerHTML='<h3>全部答對，太棒了！</h3>'; }
      progressEl.style.display='none'; timerEl.style.display='none'; articleContainer.style.display='none';
      restartBtn.style.display='block';
      const rec={timestamp:new Date().toLocaleString('zh-Hant',{hour12:false}), totalTime, correct:score, total:questions.length, wrongCount:wrongAnswers.length, section:currentSection, scorePercent: Math.round((score/questions.length)*100), wrongList:[...wrongAnswers]};
      saveResult(rec);
      if(wrongAnswers.length>0){
        const wh=JSON.parse(localStorage.getItem('wrongHistory')||'[]');
        wrongAnswers.forEach(it=>wh.push({section:currentSection,question:it.question,correctAnswer:it.correctAnswer,userAnswer:it.userAnswer}));
        localStorage.setItem('wrongHistory',JSON.stringify(wh));
      }
      prepareNextSection(currentSectionId);
    }

    function restartQuiz(){
      stopTimer(); currentQuestion=0; score=0; seconds=0; wrongAnswers.length=0;
      questionEl.style.display=''; optionsEl.style.display=''; submitBtn.style.display='';
      progressEl.style.display=''; timerEl.style.display=''; restartBtn.style.display='none'; wrongListContainer.style.display='none';
      shuffleArray(questions); startTimer(); loadQuestion(currentQuestion);
    }

    submitBtn.addEventListener('click',checkAnswer);
    nextBtn.addEventListener('click',nextQuestion);
    restartBtn.addEventListener('click',restartQuiz);
    nextSectionBtn.addEventListener('click',function(){ const t=this.dataset.section; if(t){ this.style.display='none'; startSection(t);} });

    function startTimer(){
      if(timerInterval){ clearInterval(timerInterval); timerInterval=null; }
      startTime=Date.now(); timerEl.textContent='已用時間：00:00';
      timerInterval=setInterval(()=>{ const elapsed=Math.floor((Date.now()-startTime)/1000); timerEl.textContent='已用時間：'+formatTime(elapsed); },1000);
    }
    function stopTimer(){ if(timerInterval){ clearInterval(timerInterval); timerInterval=null; } if(startTime){ seconds=Math.floor((Date.now()-startTime)/1000); } }
    function formatTime(s){ const m=Math.floor(s/60).toString().padStart(2,'0'); const ss=(s%60).toString().padStart(2,'0'); return `${m}:${ss}`; }
    function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
    function shuffleOptionsForQuestion(q){ if(!q.options||!q.options.length)return; const pairs=q.options.map((op,idx)=>({op,isC:idx===q.correct})); shuffleArray(pairs); q.options=pairs.map(p=>p.op); q.correct=pairs.findIndex(p=>p.isC); }
    function saveResult(r){ const h=JSON.parse(localStorage.getItem('quizHistory')||'[]'); h.push(r); localStorage.setItem('quizHistory',JSON.stringify(h)); }
    function renderHistory(){
      const h=JSON.parse(localStorage.getItem('quizHistory')||'[]');
      if(h.length===0){ historyContainer.innerHTML='<p>尚無紀錄，完成測驗後即可在此查看成績。</p>'; return; }
      let html='<table><thead><tr><th>日期時間</th><th>段落</th><th>完成時間</th><th>分數</th><th>正確/總題數</th><th>錯誤題數</th><th>錯誤詳情</th></tr></thead><tbody>';
      h.forEach((r,i)=>{
        const sd=(r.scorePercent!==undefined?r.scorePercent+'%':`${r.correct} / ${r.total}`);
        html+=`<tr><td>${r.timestamp}</td><td>${r.section}</td><td>${r.totalTime}</td><td>${sd}</td><td>${r.correct} / ${r.total}</td><td>${r.wrongCount}</td><td>${(r.wrongList&&r.wrongList.length>0)?`<button class="view-wrong" data-index="${i}" style="padding:5px 10px;border-radius:4px;background:var(--accent-color);color:#fff;border:none;cursor:pointer;">查看</button>`:'-'}</td></tr>`;
      });
      html+='</tbody></table>'; historyContainer.innerHTML=html;
      historyContainer.querySelectorAll('.view-wrong').forEach(btn=>{
        btn.addEventListener('click',function(){ const idx=parseInt(this.getAttribute('data-index')); showWrongDetails(idx); });
      });
    }
    function showWrongDetails(i){
      const h=JSON.parse(localStorage.getItem('quizHistory')||'[]'); const r=h[i];
      const modal=document.getElementById('wrongModal'); const details=document.getElementById('wrongDetails');
      if(!r||!r.wrongList||r.wrongList.length===0){ details.innerHTML='<p>沒有錯誤題目。</p>'; }
      else{
        let html='<h3>錯誤題目清單</h3><ul style="padding-left:18px;">';
        r.wrongList.forEach(it=>{ html+=`<li><strong>題目：</strong>${it.question}<br/><strong>你的答案：</strong>${it.userAnswer||'-'}<br/><strong>正確答案：</strong>${it.correctAnswer}</li>`; });
        html+='</ul>'; details.innerHTML=html;
      }
      modal.style.display='block';
    }
    document.getElementById('closeModal').addEventListener('click',()=>{ document.getElementById('wrongModal').style.display='none'; });
    window.addEventListener('click',e=>{ if(e.target===document.getElementById('wrongModal')) document.getElementById('wrongModal').style.display='none'; });

    function showQuiz(){ quizSection.style.display='block'; historySection.style.display='none'; sectionSection.style.display='none'; }
    function showHistory(){ quizSection.style.display='none'; historySection.style.display='block'; sectionSection.style.display='none'; renderHistory(); historyTab.classList.add('active'); quizTab.classList.remove('active'); sectionTitleEl.textContent=''; nextSectionBtn.style.display='none'; nextSectionBtn.dataset.section=''; }
    function showSectionSelection(){ quizSection.style.display='none'; historySection.style.display='none'; sectionSection.style.display='block'; quizTab.classList.add('active'); historyTab.classList.remove('active'); sectionTitleEl.textContent=''; nextSectionBtn.style.display='none'; nextSectionBtn.dataset.section=''; }

    document.getElementById('quizTab').addEventListener('click',e=>{ e.preventDefault(); showSectionSelection(); });
    document.getElementById('historyTab').addEventListener('click',e=>{ e.preventDefault(); showHistory(); });

    document.querySelectorAll('.section-btn').forEach(btn=>{
      btn.addEventListener('click',function(){ const id=this.getAttribute('data-section'); startSection(id); });
    });

    document.addEventListener('keydown',function(e){
      if(e.key==='Enter'){
        if(quizSection && quizSection.style.display!=='none'){
          const display=window.getComputedStyle(submitBtn).display;
          if(display!=='none' && !submitBtn.disabled){ e.preventDefault(); submitBtn.click(); }
        }
      }
    });

    function startSection(id){
      currentSectionId=id;
      currentSection=sectionNames[id]||id;
      setSectionTitle(id);
      nextSectionBtn.style.display='none'; nextSectionBtn.dataset.section='';
      stopTimer(); seconds=0;

      if(id==='article'){
        const p=articleExercises[0];
        questions=p.questions.slice();
        articleContainer.innerHTML=`<h3>${p.title}</h3><p>${p.text.replace(/\n/g,'<br/>')}</p>`;
        articleContainer.style.display='block';
      }else if(id==='4'){
        const p=readingPassages[Math.floor(Math.random()*readingPassages.length)];
        questions=p.questions.slice();
        articleContainer.innerHTML=`<h3>${p.title}</h3><p>${p.text.replace(/\n/g,'<br/>')}</p>`;
        articleContainer.style.display='block';
      }else{
        questions=(sectionQuestions[id]||[]).slice();
        articleContainer.style.display='none';
      }

      if(['1','2','3'].includes(id)){ shuffleArray(questions); if(questions.length>10) questions=questions.slice(0,10); }
      shuffleArray(questions); questions.forEach(q=>shuffleOptionsForQuestion(q));

      currentQuestion=0; score=0; wrongAnswers.length=0;
      showQuiz(); startTimer();
      progressEl.style.display=''; timerEl.style.display='';
      restartBtn.style.display='none'; questionEl.style.display=''; optionsEl.style.display=''; submitBtn.style.display='';
      loadQuestion(currentQuestion);
    }

    /* ============== 新增：側邊快速選單 JS ============== */
    const openSideMenuBtn=document.getElementById('openSideMenu');
    const sideMenu=document.getElementById('sideMenu');
    const sideMenuMask=document.getElementById('sideMenuMask');
    const closeSideMenuBtn=document.getElementById('closeSideMenu');
    const sideMenuBody=document.getElementById('sideMenuBody');

    const sideMenuSections=[
      {id:'vocab',label:'單字練習'},
      {id:'2',label:'家庭/職業練習'},
      {id:'greeting',label:'問候語練習'},
      {id:'be_questions',label:'Be 動詞疑問'},
      {id:'wh_questions',label:'Who/How 問句'},
      {id:'possessive',label:'所有格練習'},
      {id:'adj_and',label:'形容詞/連接詞'},
      {id:'4',label:'閱讀理解（課文）'},
      {id:'article',label:'文章練習（隨機）'},
      {id:'dialogue',label:'對話理解'},
      {id:'plural',label:'複數規則'},
      {id:'sounds',label:'發音練習'}
    ];

    function buildSideMenu(){
      sideMenuBody.innerHTML='';
      const quick=document.createElement('div'); quick.className='side-group-title'; quick.textContent='快速連結'; sideMenuBody.appendChild(quick);
      const toMenu=document.createElement('button'); toMenu.className='side-link'; toMenu.textContent='回「練習選單」'; toMenu.onclick=()=>{ closeSideMenu(); showSectionSelection(); }; sideMenuBody.appendChild(toMenu);
      const toHistory=document.createElement('button'); toHistory.className='side-link'; toHistory.textContent='查看「歷史紀錄」'; toHistory.onclick=()=>{ closeSideMenu(); showHistory(); }; sideMenuBody.appendChild(toHistory);

      const title=document.createElement('div'); title.className='side-group-title'; title.textContent='直接開始練習'; sideMenuBody.appendChild(title);
      sideMenuSections.forEach(sec=>{
        const btn=document.createElement('button'); btn.className='side-link'; btn.textContent='• '+sec.label; btn.onclick=()=>{ closeSideMenu(); startSection(sec.id); }; sideMenuBody.appendChild(btn);
      });
    }
    buildSideMenu();

    function openSideMenu(){ sideMenu.classList.add('open'); sideMenuMask.classList.add('show'); sideMenu.setAttribute('aria-hidden','false'); }
    function closeSideMenu(){ sideMenu.classList.remove('open'); sideMenuMask.classList.remove('show'); sideMenu.setAttribute('aria-hidden','true'); }
    openSideMenuBtn.addEventListener('click',openSideMenu);
    closeSideMenuBtn.addEventListener('click',closeSideMenu);
    sideMenuMask.addEventListener('click',closeSideMenu);
    window.addEventListener('keydown',e=>{ if(e.key==='Escape') closeSideMenu(); });

    function showFloatingMenu(show){ openSideMenuBtn.style.display = show?'block':'none'; }

    // 包裝頁面切換函式：在作答頁顯示選單按鈕，其他頁面隱藏
    const __showQuiz=showQuiz, __showHistory=showHistory, __showSectionSelection=showSectionSelection;
    showQuiz=function(){ __showQuiz(); showFloatingMenu(true); };
    showHistory=function(){ __showHistory(); showFloatingMenu(false); closeSideMenu(); };
    showSectionSelection=function(){ __showSectionSelection(); showFloatingMenu(false); closeSideMenu(); };

    // 進入首頁（分類頁）
    showSectionSelection();
  </script>
</body>
</html>

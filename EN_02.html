<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>國一英文第二課練習題庫</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* 主題色與樣式變數 */
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #50e3c2;
            --accent-color: #f5a623;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
            --bg-color: #f6f8fa;
            --text-color: #333;
        }

        body {
            font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* 通用容器 */
        .quiz-container {
            max-width: 800px;
            background-color: #ffffff;
            margin: 20px auto;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            position: relative;
            border-top: 6px solid var(--primary-color);
        }

        /* 導覽列 */
        #navbar {
            text-align: center;
            margin-bottom: 20px;
        }
        #navbar a {
            margin: 0 15px;
            font-weight: 600;
            color: var(--text-color);
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }
        #navbar a:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        #timer {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.85em;
            color: #666;
        }
        #progress {
            margin-bottom: 10px;
            font-weight: 600;
        }
        .question {
            font-size: 1.15em;
            margin-bottom: 15px;
        }
        .options {
            list-style-type: none;
            padding: 0;
        }
        .options li {
            margin-bottom: 10px;
        }
        .options input[type="radio"] {
            margin-right: 6px;
        }
        .navigation {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.2s ease;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #submitBtn {
            background-color: var(--primary-color);
            color: #fff;
        }
        #submitBtn:hover:not(:disabled) {
            background-color: #357ab7;
        }
        #nextBtn {
            background-color: var(--success-color);
            color: #fff;
        }
        #nextBtn:hover:not(:disabled) {
            background-color: #239a5a;
        }
        #restartBtn {
            background-color: var(--danger-color);
            color: #fff;
            width: 100%;
            margin-top: 25px;
        }
        #restartBtn:hover {
            background-color: #c0392b;
        }
        #result {
            text-align: center;
            font-size: 1.1em;
            margin-top: 20px;
            line-height: 1.5;
        }
        #wrong-list {
            margin-top: 15px;
            background-color: #f9f9f9;
            border-radius: 6px;
            padding: 15px;
        }
        #wrong-list h3 {
            margin: 0;
            font-weight: 600;
            color: var(--danger-color);
        }
        #wrong-list ul {
            list-style-type: disc;
            padding-left: 18px;
        }
        /* 歷史紀錄表格樣式 */
        #historyContainer table {
            width: 100%;
            border-collapse: collapse;
        }
        #historyContainer th, #historyContainer td {
            padding: 10px;
            border: 1px solid #e1e4e8;
            text-align: center;
        }
        #historyContainer th {
            background-color: #f5f7fa;
            font-weight: 600;
        }
        /* 段落選擇按鈕區佈局 */
        .section-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .section-btn {
            color: #fff;
            font-weight: 600;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.1s ease, box-shadow 0.2s ease;
        }
        .section-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        /* 各按鈕的色系 */
        .btn-orange { background-color: #f39c12; }
        .btn-green  { background-color: #16a085; }
        /* 新增紫色按鈕，用於文法練習 */
        .btn-purple { background-color: #8e44ad; }
        /* 新增藍綠色按鈕，用於語法探索練習 */
        .btn-teal { background-color: #27ae60; }
        /* 新增棕色按鈕，用於介系詞練習 */
        .btn-brown { background-color: #8e5a2b; }
        /* 新增粉色按鈕，用於課文閱讀練習 */
        .btn-pink { background-color: #e84393; }
    </style>
</head>
<body>
<h1>國一英文第二課練習題庫</h1>

<!-- 導覽列，用於切換測驗與歷史紀錄 -->
<nav id="navbar" style="text-align:center; margin-bottom:20px;">
    <a href="index.html" style="margin-right:20px; font-weight:bold; color:#2c3e50; text-decoration:none;">選課程</a>
    <a id="quizTab" href="#" style="margin-right:20px; font-weight:bold; color:#2c3e50; text-decoration:none;">練習選單</a>
    <a id="historyTab" href="#" style="font-weight:bold; color:#2c3e50; text-decoration:none;">歷史紀錄</a>
</nav>

<!-- 段落選擇區塊 -->
<div class="quiz-container" id="section-section">
    <h2 style="text-align:center;">選擇練習分類開始測驗</h2>
    <!-- 單字練習 -->
    <div class="section-group">
        <h3>單字練習</h3>
        <div class="section-buttons">
            <button class="section-btn btn-orange" data-section="vocab">單字練習</button>
            <button class="section-btn btn-green" data-section="sentences">句型練習</button>
            <button class="section-btn btn-purple" data-section="grammar">文法練習</button>
            <button class="section-btn btn-teal" data-section="explore">語法探索</button>
            <button class="section-btn btn-brown" data-section="prepositions">介系詞練習</button>
            <button class="section-btn btn-pink" data-section="reading">課文閱讀</button>
        </div>
    </div>
</div>

<!-- 測驗區塊 -->
<div class="quiz-container" id="quiz-section" style="display:none;">
    <h2 id="sectionTitle" style="text-align:center; margin-top:0; margin-bottom:15px; color: var(--primary-color);"></h2>
    <!-- 閱讀文本容器，僅在課文閱讀時顯示 -->
    <div id="readingText" style="display:none; background-color:#f9f9f9; padding:10px; border-radius:6px; margin-bottom:15px; max-height:180px; overflow-y:auto; font-size:0.9em; line-height:1.5; border:1px solid #e1e4e8; white-space:pre-wrap;">
        <p><strong>Dialogue 1:</strong> (Jamie is at Zac's house.)<br>
        Zac: Come meet my parents.<br>
        Jamie: OK.<br>
        Zac: Mom and Dad, this is Jamie.<br>
        Jamie: Nice to meet you, Mr. and Mrs. Hugo.<br>
        Zac's dad: Nice to meet you, too.<br>
        Jamie: Wow, the living room walls are purple.<br>
        Zac's mom: Well, purple is my favorite color.<br>
        Jamie: Are the kitchen and the dining room purple, too?<br>
        Zac: The dining room is, but the kitchen isn’t. It’s gray.</p>

        <p><strong>Dialogue 2:</strong><br>
        Jamie: What are those in the brown box?<br>
        Zac: They're cookies for my mice, Mickey, Minnie, and Molly.<br>
        Jamie: Where are they?<br>
        Zac: They're in their house. Oh, no. Where's Mickey?<br>
        Jamie: Maybe he's under the sofa.<br>
        Zac: No, he's not.<br>
        Jamie: Look. He's next to the box.<br>
        Zac: He's hungry, haha.<br>
        Jamie: He really is.</p>

        <p><strong>Reading:</strong> The Keret House is a small house in Poland. It is long, thin, and very special. Inside the house, the bathroom, the kitchen, and the dining room are right next to each other. The bedroom is above those three rooms. The Keret House is not big, but it is enough for one person.</p>
    </div>
    <div id="timer">已用時間：00:00</div>
    <div id="progress">第 1 / 20 題</div>
    <div id="quiz">
        <div class="question" id="question"></div>
        <ul class="options" id="options"></ul>
        <!-- 音訊播放按鈕，僅在聽力題時顯示 -->
        <button id="audioBtn" style="display:none; margin-top:10px; padding:6px 12px; background-color: var(--accent-color); color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:0.9em;">播放發音</button>
    </div>
    <div class="navigation">
        <button id="submitBtn">確認答案</button>
        <button id="nextBtn" style="display:none;">下一題</button>
    </div>
    <div id="result"></div>
    <div id="wrong-list" style="display:none;"></div>
    <button id="restartBtn" style="display:none;">重新開始</button>
</div>

<!-- 歷史紀錄區塊 -->
<div class="quiz-container" id="history-section" style="display:none;">
    <h2 style="text-align:center;">歷史紀錄</h2>
    <div id="historyContainer" style="margin-top:20px;"></div>
</div>

<script>
    // 第二課單字列表：中英對照
    const vocabList = [
        { english: 'house', chinese: '房子' },
        { english: 'parents', chinese: '父母親' },
        { english: 'living room', chinese: '客廳' },
        { english: 'wall', chinese: '牆壁' },
        { english: 'purple', chinese: '紫色的' },
        { english: 'favorite', chinese: '最喜愛的' },
        { english: 'color', chinese: '顏色' },
        { english: 'kitchen', chinese: '廚房' },
        { english: 'dining room', chinese: '餐廳' },
        { english: 'but', chinese: '但是' },
        { english: 'gray', chinese: '灰色的' },
        { english: 'brown', chinese: '棕色的' },
        { english: 'cookie', chinese: '餅乾' },
        { english: 'mice', chinese: '老鼠' },
        { english: 'maybe', chinese: '可能' },
        { english: 'sofa', chinese: '沙發' },
        { english: 'hungry', chinese: '餓的' },
        { english: 'notebook', chinese: '筆記本' },
        { english: 'marker', chinese: '彩色筆' },
        { english: 'brush', chinese: '筆刷' },
        { english: 'gift', chinese: '禮物' },
        { english: 'pencil case', chinese: '鉛筆盒' },
        { english: 'bathroom', chinese: '浴室' },
        { english: 'table', chinese: '桌子' },
        { english: 'bedroom', chinese: '臥室' },
        { english: 'near', chinese: '在附近' },
        { english: 'between', chinese: '在之間' },
        { english: 'behind', chinese: '在後面' },
        { english: 'in front of', chinese: '在前面' },
        { english: 'special', chinese: '特別的' },
        { english: 'inside', chinese: '在裡面' },
        { english: 'right', chinese: '就' },
        { english: 'each other', chinese: '彼此' },
        { english: 'above', chinese: '在上方' },
        { english: 'enough', chinese: '足夠的' },
        { english: 'person', chinese: '人' }
    ];

    // 全局變數
    let questions = [];
    let currentQuestion = 0;
    let score = 0;
    let seconds = 0;
    let timerInterval = null;
    const wrongAnswers = [];
    const history = [];
    let currentSection = null;

    // 洗牌函式
    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // 根據 vocabList 隨機生成題目
    function generateQuestions() {
        const generated = [];
        // 從全部單字中隨機挑選 10 個，避免每次練習題目過多
        const indices = Array.from({ length: vocabList.length }, (_, i) => i);
        shuffle(indices);
        const chosen = indices.slice(0, 10);
        chosen.forEach(idx => {
            const item = vocabList[idx];
            // 隨機決定題型：chToEn、enToCh、audio 或 scramble
            const types = ['chToEn', 'enToCh', 'audio', 'scramble'];
            const type = types[Math.floor(Math.random() * types.length)];
            let questionText;
            let correctAnswer;
            const allEnglish = vocabList.map(v => v.english);
            const allChinese = vocabList.map(v => v.chinese);
            const options = [];
            let scrambled = '';
            if (type === 'chToEn') {
                // 中文提示，選英文
                questionText = `以下哪個單字意思是「${item.chinese}」？`;
                correctAnswer = item.english;
                // 生成錯誤選項
                const wrongs = [];
                while (wrongs.length < 3) {
                    const candidate = allEnglish[Math.floor(Math.random() * allEnglish.length)];
                    if (candidate !== correctAnswer && !wrongs.includes(candidate)) {
                        wrongs.push(candidate);
                    }
                }
                options.push(correctAnswer, ...wrongs);
            } else if (type === 'enToCh') {
                // 英文提示，選中文
                questionText = `「${item.english}」的中文是什麼？`;
                correctAnswer = item.chinese;
                const wrongs = [];
                while (wrongs.length < 3) {
                    const candidate = allChinese[Math.floor(Math.random() * allChinese.length)];
                    if (candidate !== correctAnswer && !wrongs.includes(candidate)) {
                        wrongs.push(candidate);
                    }
                }
                options.push(correctAnswer, ...wrongs);
            } else if (type === 'audio') {
                // 聽音選英文
                questionText = '請聽發音，選出正確的單字。';
                correctAnswer = item.english;
                const wrongs = [];
                while (wrongs.length < 3) {
                    const candidate = allEnglish[Math.floor(Math.random() * allEnglish.length)];
                    if (candidate !== correctAnswer && !wrongs.includes(candidate)) {
                        wrongs.push(candidate);
                    }
                }
                options.push(correctAnswer, ...wrongs);
            } else {
                // scramble 題：顯示亂序字母，選英文
                const letters = item.english.replace(/\s+/g, '').split('');
                shuffle(letters);
                scrambled = letters.join(' ');
                questionText = `由以下字母組成的單字是什麼？ ${scrambled}`;
                correctAnswer = item.english;
                const wrongs = [];
                while (wrongs.length < 3) {
                    const candidate = allEnglish[Math.floor(Math.random() * allEnglish.length)];
                    if (candidate !== correctAnswer && !wrongs.includes(candidate)) {
                        wrongs.push(candidate);
                    }
                }
                options.push(correctAnswer, ...wrongs);
            }
            // 洗牌選項
            shuffle(options);
            const correctIndex = options.indexOf(correctAnswer);
            generated.push({ question: questionText, options: options, correct: correctIndex, type: type, audioWord: type === 'audio' ? item.english : null });
        });
        // 打亂題目順序
        shuffle(generated);
        return generated;
    }

    // 句型練習題庫：根據課本句型與介系詞用法出題
    function generateSentenceQuestions() {
        const sentenceQuestions = [
            { question: 'Aunt Dolly is ___ my house.', options: ['in', 'on', 'at', 'to'], correct: 0 },
            { question: 'How are your parents? They are ___, thanks.', options: ['fine', 'hungry', 'happy', 'sad'], correct: 0 },
            { question: '「living room」指的是哪一種房間？', options: ['起居室；客廳', '浴室；盥洗室', '臥室', '餐廳'], correct: 0 },
            { question: 'Which sentence correctly uses "dining room"?', options: ['Their dining room is big.', 'Their dining table is big.', 'Their kitchen is big.', 'Their bedroom is big.'], correct: 0 },
            { question: 'Which of the following is a synonym for "sofa"?', options: ['couch', 'table', 'chair', 'bed'], correct: 0 },
            { question: 'What is the opposite of "hungry"?', options: ['full', 'thin', 'tired', 'empty'], correct: 0 },
            { question: 'Which sentence is correct?', options: ['This is my new notebook.', 'This is my new laptop.', 'This is my new marker.', 'This is my new brown.'], correct: 0 },
            { question: 'Which word means "彩色筆"?', options: ['marker', 'pencil case', 'brush', 'cookie'], correct: 0 },
            { question: 'Which of the following can also mean "pencil box"?', options: ['pencil case', 'gift', 'notebook', 'bathroom'], correct: 0 },
            { question: 'Where is the bathroom?', options: ['It is between the kitchen and the living room.', 'It is in the bedroom.', 'It is on the sofa.', 'It is under the table.'], correct: 0 },
            { question: 'My house is ___ the farm.', options: ['near', 'between', 'behind', 'in'], correct: 0 },
            { question: 'Which preposition means "在……後面"?', options: ['behind','in front of','between','near'], correct: 0 },
            { question: 'Jane is in front of Tom but behind Amy. Jane is ___ Tom and Amy.', options: ['between','in front of','behind','inside'], correct: 0 },
            { question: 'What does "inside" mean?', options: ['在裡面','在外面','在上面','在下面'], correct: 0 },
            { question: 'Which word can mean "就；馬上"?', options: ['right','left','near','between'], correct: 0 },
            { question: 'Which preposition completes: My mom is ___ the house.', options: ['in','at','on','to'], correct: 0 },
            { question: 'My car is ___ a tree.', options: ['behind','between','in','inside'], correct: 0 }
        ];
        // 隨機取 10 題
        const indices = Array.from({ length: sentenceQuestions.length }, (_, i) => i);
        shuffle(indices);
        const chosen = indices.slice(0, 10);
        const generated = [];
        chosen.forEach(i => {
            const item = sentenceQuestions[i];
            // 複製選項並洗牌
            const opts = item.options.slice();
            shuffle(opts);
            const correctIndex = opts.indexOf(item.options[item.correct]);
            generated.push({ question: item.question, options: opts, correct: correctIndex, type: 'choice', audioWord: null });
        });
        return generated;
    }

    // 文法練習題庫：根據第二課語法與課文內容出題
    function generateGrammarQuestions() {
        /*
         * 文法題針對課本中的介系詞用法、同義詞、反義詞和句子結構設計。
         * 每題提供四個選項，正確答案索引由 correct 屬性指定。
         * 題庫會在每次測驗開始時隨機抽取 10 題，並且打亂選項順序，
         * 避免題目與答案固定讓小孩記答案。
         */
        const grammarQuestions = [
            { question: 'Fill in the blank: Aunt Dolly is ___ my house.', options: ['in', 'on', 'at', 'to'], correct: 0 },
            { question: 'How are your parents? They are ___, thanks.', options: ['fine', 'hungry', 'happy', 'sad'], correct: 0 },
            { question: 'What does "living room" refer to?', options: ['起居室；客廳', '浴室；盥洗室', '臥室', '餐廳'], correct: 0 },
            { question: 'Which sentence uses "dining room" correctly?', options: ['Their dining room is big.', 'Their dining table is big.', 'Their kitchen is big.', 'Their bedroom is big.'], correct: 0 },
            { question: 'Which word is a synonym for "sofa"?', options: ['couch', 'table', 'chair', 'bed'], correct: 0 },
            { question: 'What is the opposite of "hungry"?', options: ['full', 'thin', 'tired', 'empty'], correct: 0 },
            { question: 'Which sentence is correct?', options: ['This is my new notebook.', 'This is my new laptop.', 'This is my new marker.', 'This is my new brown.'], correct: 0 },
            { question: 'Which word means "彩色筆"?', options: ['marker', 'pencil case', 'brush', 'cookie'], correct: 0 },
            { question: 'Which of the following also means "pencil box"?', options: ['pencil case', 'gift', 'notebook', 'bathroom'], correct: 0 },
            { question: 'Where is the bathroom?', options: ['It is between the kitchen and the living room.', 'It is in the bedroom.', 'It is on the sofa.', 'It is under the table.'], correct: 0 },
            { question: 'My house is ___ the farm.', options: ['near', 'between', 'behind', 'in'], correct: 0 },
            { question: 'Which preposition means "在……後面"?', options: ['behind','in front of','between','near'], correct: 0 },
            { question: 'Jane is in front of Tom but behind Amy. Jane is ___ Tom and Amy.', options: ['between','in front of','behind','inside'], correct: 0 },
            { question: 'What does "inside" mean?', options: ['在裡面','在外面','在上面','在下面'], correct: 0 },
            { question: 'Which word can mean "立即；馬上"?', options: ['right','left','near','between'], correct: 0 },
            { question: 'My mom is ___ the house.', options: ['inside','at','on','to'], correct: 0 },
            { question: 'My car is ___ a tree.', options: ['under','between','in','inside'], correct: 0 },
            { question: 'The ball is ___ the door.', options: ['behind','in front of','between','near'], correct: 0 },
            { question: 'What does "bedroom" refer to?', options: ['臥室','客廳','浴室','餐廳'], correct: 0 },
            { question: 'What does "bathroom" refer to?', options: ['浴室','客廳','書房','臥室'], correct: 0 },
            { question: 'What does "dining room" refer to?', options: ['餐廳','客廳','臥室','浴室'], correct: 0 },
            { question: 'Sofa bed 指的是什麼?', options: ['沙發床','床的沙發','餐廳','沙發椅'], correct: 0 },
            { question: 'Which preposition means "在前面"?', options: ['in front of','behind','between','near'], correct: 0 },
            { question: 'Which word also refers to a "laptop"?', options: ['notebook','marker','sofa','house'], correct: 0 },
            { question: 'Parents refers to ___?', options: ['mom and dad','teacher','brother','grandparents'], correct: 0 }
        ];
        // 產生隨機順序的題目索引
        const indices = Array.from({ length: grammarQuestions.length }, (_, i) => i);
        shuffle(indices);
        // 取前 10 題
        const chosen = indices.slice(0, 10);
        const generated = [];
        chosen.forEach(i => {
            const item = grammarQuestions[i];
            // 複製選項並打亂
            const opts = item.options.slice();
            shuffle(opts);
            const correctIndex = opts.indexOf(item.options[item.correct]);
            generated.push({ question: item.question, options: opts, correct: correctIndex, type: 'choice', audioWord: null });
        });
        return generated;
    }

    // 語法探索題庫：涵蓋複數名詞、發音規則以及代名詞疑問句
    function generateExploreQuestions() {
        /*
         * 此題庫包含多元題型：
         *  - 複數名詞形成規則
         *  - 複數名詞的正確拼寫
         *  - 複數語尾發音辨識
         *  - 複數名詞所有格用法
         *  - 使用 these/those/they 的 Yes/No 問答與疑問句
         * 每次從題庫隨機挑選 10 題並隨機排列選項，避免固定答案順序。
         */
        const exploreQuestions = [
            // 複數形成
            { question: 'What is the plural form of “family”?', options: ['families','familys','familyes','family'], correct: 0 },
            { question: 'What is the plural form of “table”?', options: ['tables','table','tabless','tablees'], correct: 0 },
            { question: 'What is the plural form of “woman”?', options: ['women','womans','woman','womens'], correct: 0 },
            { question: 'What is the plural form of “mouse” (老鼠)?', options: ['mice','mouse','mouses','mousees'], correct: 0 },
            { question: 'Which of the following is the correct plural of “fish”?', options: ['fish','fishes','fishs','fishies'], correct: 0 },
            { question: 'What is the plural form of “housewife”?', options: ['housewives','housewifes','housewife','housewifees'], correct: 0 },
            { question: 'What is the plural form of “person”?', options: ['people','persons','person','peoples'], correct: 0 },
            { question: 'What is the plural form of “watch”?', options: ['watches','watchs','watch','watchies'], correct: 0 },
            { question: 'What is the plural form of “police officer”?', options: ['police officers','police officer','polices officer','police offcers'], correct: 0 },
            { question: 'What is the plural form of “pencil case”?', options: ['pencil cases','pencils case','pencil case','pencil casees'], correct: 0 },
            { question: 'Which noun does NOT follow the regular plural rule of adding -s or -es?', options: ['person','tomatoes','buses','classes'], correct: 0 },
            // 發音規則
            { question: 'In which word is the plural ending pronounced /s/?', options: ['cats','zoos','buses','oranges'], correct: 0 },
            { question: 'In which word is the plural ending pronounced /ɪz/?', options: ['buses','desks','maps','rooms'], correct: 0 },
            { question: 'In which word is the plural ending pronounced /z/?', options: ['dogs','maps','cats','desks'], correct: 0 },
            // 所有格
            { question: 'How do you form the possessive of a plural noun ending in -s?', options: ['Add only an apostrophe (\')','Add -\'s','Do not change it','Add s\'s'], correct: 0 },
            { question: 'Which sentence correctly shows plural possession?', options: ['Those girls\' mother','Those girl\'s mother','Those girls mother','Those girl mother'], correct: 0 },
            // Yes/No 問答與代名詞
            { question: 'Which question correctly asks about plural items?', options: ['Are these erasers?','Is this erasers?','Are this eraser?','Is these erasers?'], correct: 0 },
            { question: 'What is the correct short answer to “Are those erasers?”', options: ['Yes, they are.','Yes, those are.','Yes, these are.','Yes, those erasers are.'], correct: 0 },
            { question: 'Fill in the blank: No, ___ aren\'t.', options: ['they','those','these','that'], correct: 0 },
            { question: 'Fill in the blank: Aren\'t ___ your bags? — Yes, they are.', options: ['they','those','these','that'], correct: 0 },
            { question: 'Which pronoun can replace a plural noun in an answer?', options: ['they','these','those','it'], correct: 0 },
            // wh- 疑問句
            { question: 'How do you change “What is this?” to ask about more than one item?', options: ['What are these?','What are this?','What is these?','What are that?'], correct: 0 },
            { question: 'Which sentence correctly uses a plural demonstrative?', options: ['Those are pencils.','That are pencils.','This are pencils.','These is pencils.'], correct: 0 }
        ];
        const indices = Array.from({ length: exploreQuestions.length }, (_, i) => i);
        shuffle(indices);
        const chosen = indices.slice(0, 10);
        const generated = [];
        chosen.forEach(i => {
            const item = exploreQuestions[i];
            const opts = item.options.slice();
            shuffle(opts);
            const correctIndex = opts.indexOf(item.options[item.correct]);
            generated.push({ question: item.question, options: opts, correct: correctIndex, type: 'choice', audioWord: null });
        });
        return generated;
    }

    // 介系詞與連接詞題庫：涵蓋位置介系詞與 but/and 用法
    function generatePrepositionQuestions() {
        /*
         * 題庫涵蓋三個主題：
         * 1. 填空題：選出正確的介系詞，描述物件的相對位置。
         * 2. 問答題：Where 問句的正確問法與回答。
         * 3. 連接詞 but/and 的使用，用於連接形容詞或兩個句子。
         * 每次隨機抽取 10 題並打亂選項順序，避免背答案。
         */
        const prepositionQuestions = [
            // 介系詞填空
            { question: 'Fill in the blank: The oranges are ___ the desk.', options: ['on','in','under','above'], correct: 0 },
            { question: 'Fill in the blank: The school is ___ the park.', options: ['near','at','behind','on'], correct: 0 },
            { question: 'Fill in the blank: The desk is ___ the sofa.', options: ['behind','under','on','near'], correct: 0 },
            { question: 'Fill in the blank: We are ___ Sophia\'s house.', options: ['at','in','on','near'], correct: 0 },
            { question: 'Fill in the blank: The basketball is ___ the table.', options: ['under','above','in front of','next to'], correct: 0 },
            { question: 'Fill in the blank: The markers are ___ the pencil case.', options: ['in','on','under','between'], correct: 0 },
            { question: 'Fill in the blank: The notebooks are ___ the comic books.', options: ['next to','under','above','between'], correct: 0 },
            { question: 'Fill in the blank: A clock is ___ the TV.', options: ['on','in','under','behind'], correct: 0 },
            { question: 'Fill in the blank: Two cats are ___ the cabinet.', options: ['in front of','behind','next to','under'], correct: 0 },
            { question: 'Fill in the blank: My bag is ___ the box and the umbrellas.', options: ['between','next to','on','near'], correct: 0 },
            // Where 問句與回答
            { question: 'Complete the dialogue: A: Where is your sister? B: ___', options: ['She is in the kitchen.','She is at the park.','She is on the bed.','She is near the house.'], correct: 0 },
            { question: 'Complete the dialogue: A: Where are the notebooks? B: ___', options: ['They are in the purple box.','They are under the chair.','They are behind the door.','They are next to the table.'], correct: 0 },
            { question: 'Complete the dialogue: A: Where\'s the dog? B: ___', options: ['It\'s under the chair.','It\'s in the bedroom.','It\'s on the table.','It\'s behind the box.'], correct: 0 },
            { question: 'Complete the dialogue: A: Where\'s Dad? B: ___', options: ['He\'s over there.','He\'s under the chair.','He\'s in front of the bus.','He\'s at home.'], correct: 0 },
            // but / and 用法
            { question: 'Complete the sentence: Kate is hungry, ___ her brother isn\'t.', options: ['but','and','or','so'], correct: 0 },
            { question: 'Complete the sentence: The house is old ___ big.', options: ['but','and','so','or'], correct: 0 },
            { question: 'Complete the sentence: Sylvia is beautiful, ___ she is not very nice.', options: ['but','and','so','or'], correct: 0 },
            { question: 'Complete the sentence: Mr. Wang is short, ___ his son is very tall.', options: ['but','and','so','or'], correct: 0 },
            { question: 'Complete the sentence: My mom is a singer, ___ my dad is, too.', options: ['and','but','or','so'], correct: 0 },
            { question: 'Choose the correct combined sentence for: “The woman is tall. Her husband is short.”', options: ['The woman is tall, but her husband is short.','The woman is tall, and her husband is short.','The woman is tall and her husband is short.','The woman is tall, but her husband short is.'], correct: 0 },
            { question: 'Choose the correct combined sentence for: “They are at the park. Their parents are not at the park.”', options: ['They are at the park, but their parents are not.','They are at the park, and their parents are not.','They are at the park but their parents are.','They are at the park, or their parents are not.'], correct: 0 },
            { question: 'Which article is used with a specific singular noun that has been mentioned before?', options: ['the','a','an','some'], correct: 0 },
            { question: 'Where\'s is a contraction of which phrase?', options: ['where is','when is','what is','who is'], correct: 0 },
            { question: 'Fill in the blank: A: Where\'s the dog? B: It\'s ___ the chair.', options: ['under','in','above','behind'], correct: 0 }
        ];
        const indices = Array.from({ length: prepositionQuestions.length }, (_, i) => i);
        shuffle(indices);
        const chosen = indices.slice(0, 10);
        const generated = [];
        chosen.forEach(i => {
            const item = prepositionQuestions[i];
            const opts = item.options.slice();
            shuffle(opts);
            const correctIndex = opts.indexOf(item.options[item.correct]);
            generated.push({ question: item.question, options: opts, correct: correctIndex, type: 'choice', audioWord: null });
        });
        return generated;
    }

    // 課文閱讀題庫：根據對話與閱讀內容出題
    function generateReadingQuestions() {
        /*
         * 題庫根據課文對話與閱讀文章內容出題。
         * 包含對話理解、詞彙選擇、翻譯、閱讀理解等題型。
         * 每次隨機選取 10 題並打亂選項順序。
         */
        const readingQuestions = [
            // 對話理解
            { question: 'Who does Zac invite Jamie to meet?', options: ['His parents','His friends','His cousins','His teacher'], correct: 0 },
            { question: 'How does Zac introduce Jamie to his parents?', options: ['Mom and Dad, this is Jamie.','Mom and Dad, meet Jamie.','Dad and Mom, this is Jamie.','Hello, Jamie meet my parents.'], correct: 0 },
            { question: 'Why does Jamie say “Wow” in the dialogue?', options: ['Because the living room walls are purple.','Because Zac’s mom is his teacher.','Because the living room is messy.','Because he sees Mickey.'], correct: 0 },
            { question: 'What is Zac\'s mom\'s favorite color?', options: ['Purple','Gray','Blue','Green'], correct: 0 },
            { question: 'Are the kitchen and the dining room purple, too?', options: ['The dining room is, but the kitchen isn\'t.','Both are purple.','Neither is purple.','The kitchen is, but the dining room isn\'t.'], correct: 0 },
            { question: 'What color is the kitchen in Zac\'s house?', options: ['Gray','Purple','Brown','White'], correct: 0 },
            { question: 'My favorite ____ is gray, not purple.', options: ['color','drink','family','number'], correct: 0 },
            { question: 'Hi, Ray. Welcome to my house. ______ B: OK. Wow, they are cute.', options: ['Come meet my dogs.','This is my dog.','Are they your dogs?','Is this your favorite dog?'], correct: 0 },
            // 翻譯題
            { question: 'Translate: 我的房子是新的，但車子不是。', options: ['My house is new, but my car isn\'t.','My house is old, but my car is new.','My car is new, but my house is not new.','My house is old, but my car isn\'t.'], correct: 0 },
            { question: 'Translate: 來見見我的表哥，Max。', options: ['Come meet my cousin, Max.','Come see my cousin, Max.','Come meet my cousin Max.','Come meet my brother, Max.'], correct: 0 },
            // 第二段對話
            { question: 'What are those in the brown box?', options: ['Cookies for Zac\'s mice','Cookies for Jamie\'s dogs','Brown cookies','Books'], correct: 0 },
            { question: 'Who are Mickey, Minnie, and Molly?', options: ['Zac\'s mice','Zac\'s dogs','Zac\'s cats','Zac\'s rabbits'], correct: 0 },
            { question: 'Where are the mice?', options: ['They\'re in their house.','They\'re under the sofa.','They\'re on the table.','They\'re next to the box.'], correct: 0 },
            { question: 'Where is Mickey?', options: ['He\'s next to the box.','He\'s under the sofa.','He\'s in the brown box.','He\'s at the park.'], correct: 0 },
            // Keret House 閱讀理解
            { question: 'Where is the Keret House located?', options: ['Poland','Paris','The USA','London'], correct: 0 },
            { question: 'Which rooms are right next to each other inside the Keret House?', options: ['The bathroom, the kitchen, and the dining room','The living room, bedroom, and bathroom','The kitchen, dining room, and bedroom','The living room, kitchen, and bathroom'], correct: 0 },
            { question: 'Where is the bedroom in the Keret House?', options: ['Above the bathroom, kitchen, and dining room','Inside the bathroom','Next to the kitchen','Below the house'], correct: 0 },
            { question: 'Which statement describes the Keret House?', options: ['It is not big, but it is enough for one person.','It is big and suitable for a family of four.','It is small but not enough for one person.','It is not enough for two people.'], correct: 0 },
            { question: 'Which adjectives describe the Keret House?', options: ['long, thin, and very special','short, wide, and old','long, wide, and special','thick, short, and old'], correct: 0 },
            // p53 選擇題
            { question: 'The cat is ___ those two chairs.', options: ['between','in','inside','of'], correct: 0 },
            { question: 'A: Where is your baby girl? B: ______.', options: ['She\'s next to the sofa.','She\'s hungry.','She\'s one.','She\'s a nice girl.'], correct: 0 },
            // 翻譯 p53
            { question: 'Translate: 這間房間是雙人房。', options: ['This room is for two people.','This room is for one person.','This house is for two people.','This room is big.'], correct: 0 },
            { question: 'Translate: 我的筆記本在兩本紅色的書中間。', options: ['My notebook is between the two red books.','My notebook is under the red books.','My notebook is next to the red books.','My pen is between two red books.'], correct: 0 },
            { question: 'Translate: 紫色的車正與黑色的車緊緊相鄰。', options: ['The purple car is next to the black car.','The purple car is behind the black car.','The purple car is in front of the black car.','The purple car is between two black cars.'], correct: 0 }
        ];
        // 隨機抽取 10 題
        const indices = Array.from({ length: readingQuestions.length }, (_, i) => i);
        shuffle(indices);
        const chosen = indices.slice(0, 10);
        const generated = [];
        chosen.forEach(i => {
            const item = readingQuestions[i];
            const opts = item.options.slice();
            shuffle(opts);
            const correctIndex = opts.indexOf(item.options[item.correct]);
            generated.push({ question: item.question, options: opts, correct: correctIndex, type: 'choice', audioWord: null });
        });
        return generated;
    }

    // 開始測驗，根據 sectionId 決定題庫
    function startQuiz(sectionId) {
        currentSection = sectionId;
        // 根據不同分類生成題目
        if (sectionId === 'vocab') {
            questions = generateQuestions();
            document.getElementById('sectionTitle').textContent = '單字練習';
            // 隱藏閱讀文本
            document.getElementById('readingText').style.display = 'none';
        } else if (sectionId === 'sentences') {
            questions = generateSentenceQuestions();
            document.getElementById('sectionTitle').textContent = '句型練習';
            document.getElementById('readingText').style.display = 'none';
        } else if (sectionId === 'grammar') {
            questions = generateGrammarQuestions();
            document.getElementById('sectionTitle').textContent = '文法練習';
            document.getElementById('readingText').style.display = 'none';
        } else if (sectionId === 'explore') {
            questions = generateExploreQuestions();
            document.getElementById('sectionTitle').textContent = '語法探索';
            document.getElementById('readingText').style.display = 'none';
        } else if (sectionId === 'prepositions') {
            questions = generatePrepositionQuestions();
            document.getElementById('sectionTitle').textContent = '介系詞練習';
            document.getElementById('readingText').style.display = 'none';
        } else if (sectionId === 'reading') {
            questions = generateReadingQuestions();
            document.getElementById('sectionTitle').textContent = '課文閱讀';
            // 顯示閱讀文本
            document.getElementById('readingText').style.display = 'block';
        } else {
            // 預設使用單字題庫
            questions = generateQuestions();
            document.getElementById('sectionTitle').textContent = '';
            document.getElementById('readingText').style.display = 'none';
        }
        // 重置狀態
        currentQuestion = 0;
        score = 0;
        seconds = 0;
        wrongAnswers.length = 0;
        // 顯示測驗區域，隱藏其他區域
        document.getElementById('section-section').style.display = 'none';
        document.getElementById('history-section').style.display = 'none';
        document.getElementById('quiz-section').style.display = 'block';
        // 顯示按鈕狀態
        document.getElementById('submitBtn').style.display = 'inline-block';
        document.getElementById('submitBtn').disabled = false;
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('restartBtn').style.display = 'none';
        document.getElementById('result').textContent = '';
        document.getElementById('wrong-list').style.display = 'none';
        // 顯示計時
        document.getElementById('timer').style.display = '';
        document.getElementById('progress').style.display = '';
        // 開始計時
        startTimer();
        // 載入第一題
        loadQuestion(currentQuestion);
    }

    // 載入單題
    function loadQuestion(index) {
        const q = questions[index];
        document.getElementById('result').textContent = '';
        // 顯示題目文本
        document.getElementById('question').textContent = `${index + 1}. ${q.question}`;
        const optionsEl = document.getElementById('options');
        optionsEl.innerHTML = '';
        const audioBtn = document.getElementById('audioBtn');
        // 若為音訊題目，自動播放發音，並顯示重播按鈕
        if (q.type === 'audio' && q.audioWord) {
            speak(q.audioWord);
            audioBtn.style.display = 'inline-block';
            audioBtn.onclick = () => speak(q.audioWord);
        } else {
            audioBtn.style.display = 'none';
            audioBtn.onclick = null;
        }
        q.options.forEach((option, i) => {
            const li = document.createElement('li');
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'option';
            input.value = i;
            label.appendChild(input);
            label.appendChild(document.createTextNode(option));
            li.appendChild(label);
            optionsEl.appendChild(li);
        });
        document.getElementById('submitBtn').disabled = false;
        document.getElementById('nextBtn').style.display = 'none';
        // 更新進度顯示
        document.getElementById('progress').textContent = `第 ${index + 1} / ${questions.length} 題`;
    }

    // 檢查答案
    function checkAnswer() {
        const selected = document.querySelector('input[name="option"]:checked');
        if (!selected) {
            alert('請選擇一個答案！');
            return;
        }
        const answer = parseInt(selected.value);
        const q = questions[currentQuestion];
        const correctIndex = q.correct;
        const resultEl = document.getElementById('result');
        if (answer === correctIndex) {
            score++;
            resultEl.style.color = '#2ecc71';
            resultEl.textContent = '回答正確！';
        } else {
            resultEl.style.color = '#e74c3c';
            const correctText = q.options[correctIndex];
            resultEl.textContent = `答錯了！正確答案是：${correctText}`;
            wrongAnswers.push({
                question: q.question,
                correctAnswer: correctText,
                userAnswer: q.options[answer]
            });
        }
        document.getElementById('submitBtn').disabled = true;
        // 判斷是否還有下一題
        if (currentQuestion < questions.length - 1) {
            document.getElementById('nextBtn').style.display = 'inline-block';
        } else {
            showFinalResult();
        }
    }

    // 下一題
    function nextQuestion() {
        currentQuestion++;
        if (currentQuestion < questions.length) {
            loadQuestion(currentQuestion);
        }
    }

    // 顯示最終結果
    function showFinalResult() {
        stopTimer();
        const resultEl = document.getElementById('result');
        resultEl.style.color = '#333';
        resultEl.innerHTML = `你答對了 ${score} 題，總共 ${questions.length} 題。<br>總用時：${formatTime(seconds)}`;
        // 顯示錯誤清單
        const wrongListEl = document.getElementById('wrong-list');
        wrongListEl.innerHTML = '';
        if (wrongAnswers.length > 0) {
            wrongListEl.style.display = 'block';
            const h3 = document.createElement('h3');
            h3.textContent = '錯誤題目';
            wrongListEl.appendChild(h3);
            const ul = document.createElement('ul');
            wrongAnswers.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.question} 正確答案：${item.correctAnswer}；你的答案：${item.userAnswer}`;
                ul.appendChild(li);
            });
            wrongListEl.appendChild(ul);
        } else {
            wrongListEl.style.display = 'none';
        }
        // 記錄歷史
        history.push({
            date: new Date().toLocaleString('zh-TW', { hour12: false }),
            score: score,
            total: questions.length,
            time: formatTime(seconds),
            wrong: wrongAnswers.slice()
        });
        // 顯示重試按鈕
        document.getElementById('restartBtn').style.display = 'block';
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'none';
    }

    // 開始計時
    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            seconds++;
            document.getElementById('timer').textContent = `已用時間：${formatTime(seconds)}`;
        }, 1000);
    }

    // 停止計時
    function stopTimer() {
        clearInterval(timerInterval);
    }

    // 格式化時間
    function formatTime(sec) {
        const mins = Math.floor(sec / 60).toString().padStart(2, '0');
        const secs = (sec % 60).toString().padStart(2, '0');
        return `${mins}:${secs}`;
    }

    // 使用瀏覽器語音 API 播放單字發音
    function speak(word) {
        try {
            if ('speechSynthesis' in window) {
                const utter = new SpeechSynthesisUtterance(word);
                utter.lang = 'en-US';
                window.speechSynthesis.speak(utter);
            }
        } catch (e) {
            // 若瀏覽器不支援則忽略
            console.warn('語音播放失敗：', e);
        }
    }

    // 更新歷史紀錄顯示
    function updateHistory() {
        const container = document.getElementById('historyContainer');
        if (history.length === 0) {
            container.innerHTML = '<p>目前沒有紀錄。</p>';
            return;
        }
        let html = '<table><tr><th>日期時間</th><th>分數</th><th>耗時</th><th>詳細錯誤</th></tr>';
        history.forEach((item, idx) => {
            html += `<tr><td>${item.date}</td><td>${item.score}/${item.total}</td><td>${item.time}</td><td><button onclick="showWrongDetails(${idx})">查看</button></td></tr>`;
        });
        html += '</table>';
        container.innerHTML = html;
    }

    // 顯示某次測驗的錯誤詳情
    window.showWrongDetails = function(index) {
        const item = history[index];
        let html = '<h3>錯誤題目詳情</h3><ul>';
        item.wrong.forEach(w => {
            html += `<li>${w.question} 正確答案：${w.correctAnswer}；你的答案：${w.userAnswer}</li>`;
        });
        html += '</ul>';
        alert(html.replace(/<[^>]+>/g, ''));
    };

    // 切換到練習選單
    function showSectionMenu() {
        stopTimer();
        document.getElementById('quiz-section').style.display = 'none';
        document.getElementById('history-section').style.display = 'none';
        document.getElementById('section-section').style.display = 'block';
        // 隱藏閱讀文本容器
        document.getElementById('readingText').style.display = 'none';
    }

    // 切換到歷史紀錄
    function showHistory() {
        stopTimer();
        document.getElementById('quiz-section').style.display = 'none';
        document.getElementById('section-section').style.display = 'none';
        document.getElementById('history-section').style.display = 'block';
        updateHistory();
        // 隱藏閱讀文本容器
        document.getElementById('readingText').style.display = 'none';
    }

    // DOM 事件綁定
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('quizTab').addEventListener('click', (e) => {
            e.preventDefault();
            showSectionMenu();
        });
        document.getElementById('historyTab').addEventListener('click', (e) => {
            e.preventDefault();
            showHistory();
        });
        // 單字練習按鈕
        const sectionButtons = document.querySelectorAll('.section-btn');
        sectionButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const sectionId = btn.dataset.section || 'vocab';
                startQuiz(sectionId);
            });
        });
        // 提交答案
        document.getElementById('submitBtn').addEventListener('click', checkAnswer);
        // 下一題
        document.getElementById('nextBtn').addEventListener('click', () => {
            nextQuestion();
        });
        // 重新開始
        document.getElementById('restartBtn').addEventListener('click', () => {
            showSectionMenu();
        });

        // 鍵盤 Enter 鍵觸發提交或下一題
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const submitBtn = document.getElementById('submitBtn');
                const nextBtn = document.getElementById('nextBtn');
                // 若提交按鈕顯示且可用，執行提交
                if (submitBtn.style.display !== 'none' && !submitBtn.disabled) {
                    checkAnswer();
                    e.preventDefault();
                } else if (nextBtn.style.display !== 'none') {
                    nextQuestion();
                    e.preventDefault();
                }
            }
        });
    });
</script>
</body>
</html>